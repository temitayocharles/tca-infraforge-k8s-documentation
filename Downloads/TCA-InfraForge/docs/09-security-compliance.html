<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCA InfraForge Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 30px;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .pagination {
            justify-content: center;
        }

        .page-link {
            color: #667eea;
        }

        .page-link:hover {
            color: #764ba2;
        }

        .btn-prev,
        .btn-next {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
        }

        .btn-prev:hover,
        .btn-next:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
        }

        h1,
        h2,
        h3 {
            color: #333;
        }

        code {
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 4px;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .emoji {
            font-size: 1.2em;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
        }

        body.dark-mode .container {
            background: #2c3e50;
            color: #ecf0f1;
        }

        body.dark-mode .navbar {
            background: rgba(44, 62, 80, 0.9);
        }

        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3 {
            color: #ecf0f1;
        }

        body.dark-mode code {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode pre {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode table th {
            background-color: #34495e;
        }

        body.dark-mode table td {
            border-color: #7f8c8d;
        }

        .copy-btn {
            opacity: 0.7;
        }

        .copy-btn:hover {
            opacity: 1;
        }

        .content {
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">TCA InfraForge Docs</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Pages</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="01-executive-summary.html">1. Executive Summary</a></li>
                            <li><a class="dropdown-item" href="02-architecture-overview.html">2. Architecture
                                    Overview</a></li>
                            <li><a class="dropdown-item" href="03-quick-start-guide.html">3. Quick Start Guide</a></li>
                            <li><a class="dropdown-item" href="04-automated-deployment.html">4. Automated Deployment</a>
                            </li>
                            <li><a class="dropdown-item" href="05-container-kubernetes.html">5. Container &
                                    <img src="https://kubernetes.io/images/favicon.png" alt="Kubernetes"
                                        style="height:1.2em; vertical-align:middle;"> Kubernetes</a></li>
                            <li><a class="dropdown-item" href="06-networking-ingress.html">6. Networking & Ingress</a>
                            </li>
                            <li><a class="dropdown-item" href="07-monitoring-observability.html">7. Monitoring &
                                    Observability</a></li>
                            <li><a class="dropdown-item" href="08-enterprise-applications.html">8. Enterprise
                                    Applications</a></li>
                            <li><a class="dropdown-item" href="09-security-compliance.html">9. Security & Compliance</a>
                            </li>
                            <li><a class="dropdown-item" href="10-cloudflare-integration.html">10. Cloudflare
                                    Integration</a></li>
                            <li><a class="dropdown-item" href="11-performance-optimization.html">11. Performance
                                    Optimization</a></li>
                            <li><a class="dropdown-item" href="12-ci-cd-pipeline.html">12. CI/CD Pipeline</a></li>
                            <li><a class="dropdown-item" href="13-contributing-development.html">13. Contributing &
                                    Development</a></li>
                        </ul>
                    </li>
                </ul>
                <form class="d-flex me-2">
                    <input class="form-control me-2" type="search" placeholder="Search headings..." id="searchInput">
                </form>
                <div class="d-flex">
                    <button class="btn btn-outline-secondary me-2" id="darkModeToggle">
                        <i class="fas fa-moon"></i> Dark
                    </button>
                    <button class="btn btn-prev me-2" id="prevBtn">Previous</button>
                    <button class="btn btn-next" id="nextBtn">Next</button>
                </div>
            </div>
        </div>
    </nav>

    <div id="progressBar" style="height: 4px; background: linear-gradient(45deg, #667eea, #764ba2); width: 0%; position: fixed; top: 0; left: 0; z-index: 1000;"></div>

    <div class="container">
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination">
                <!-- Pagination will be generated by JS -->
            </ul>
        </nav>

        <div class="content">
            <h1 id="chapter-9-security-compliance">ğŸ”’ Chapter 9: Security &amp; Compliance</h1>
<h2 id="learning-objectives">ğŸ¯ Learning Objectives</h2>
<p>By the end of this chapter, youâ€™ll understand: - TCA InfraForgeâ€™s security-first architecture - Implementing zero-trust security principles - Compliance frameworks and audit capabilities - Security hardening and best practices</p>
<p><strong>â±ï¸ Time to Complete:</strong> 30-35 minutes<br />
<strong>ğŸ’¡ Difficulty:</strong> Intermediate to Advanced<br />
<strong>ğŸ¯ Prerequisites:</strong> Understanding of networking and system administration</p>
<hr />
<h2 id="security-first-philosophy">ğŸ›¡ï¸ Security-First Philosophy</h2>
<p>TCA InfraForge is built with <strong>security as the foundation</strong>, not an afterthought. We implement <strong>defense in depth</strong> - multiple layers of protection that work together to create an impenetrable security posture.</p>
<h3 id="zero-trust-architecture-principles">Zero-Trust Architecture Principles</h3>
<ul>
<li><strong>ğŸ” Never Trust, Always Verify:</strong> Every request is authenticated and authorized</li>
<li><strong>ğŸ›¡ï¸ Least Privilege Access:</strong> Users get only the minimum permissions needed</li>
<li><strong>ğŸ“Š Complete Visibility:</strong> Full audit trail of all activities</li>
<li><strong>ğŸ”„ Micro-Segmentation:</strong> Network isolation between all components</li>
<li><strong>ğŸš¨ Continuous Monitoring:</strong> Real-time threat detection and response</li>
</ul>
<p><strong>Real-world analogy:</strong> Like a bank vault with multiple combination locks, security cameras, motion sensors, and armed guards - each layer provides protection even if others fail.</p>
<hr />
<h2 id="security-architecture-overview">ğŸ—ï¸ Security Architecture Overview</h2>
<h3 id="defense-in-depth-layers">Defense in Depth Layers</h3>
<pre class="mermaid"><code>graph TB
    subgraph &quot;Network Security&quot;
        CLOUDFLARE[â˜ï¸ Cloudflare WAF&lt;br/&gt;DDoS Protection&lt;br/&gt;Rate Limiting]
        INGRESS[ğŸŒ NGINX Ingress&lt;br/&gt;SSL Termination&lt;br/&gt;Request Filtering]
        NETWORK_POLICIES[ğŸ”’ Kubernetes Network Policies&lt;br/&gt;Traffic Segmentation]
        SERVICE_MESH[ğŸ”— Service Mesh&lt;br/&gt;mTLS Encryption]
    end

    subgraph &quot;Access Control&quot;
        OAUTH[ğŸ” OAuth2 Proxy&lt;br/&gt;Authentication Gateway]
        RBAC[ğŸ‘¥ Role-Based Access Control&lt;br/&gt;Authorization]
        VAULT[ğŸ”’ HashiCorp Vault&lt;br/&gt;Secrets Management]
        CERT_MANAGER[ğŸ“œ Certificate Manager&lt;br/&gt;SSL/TLS Certificates]
    end

    subgraph &quot;Data Protection&quot;
        ENCRYPTION[ğŸ” Data Encryption&lt;br/&gt;At Rest &amp; In Transit]
        BACKUP_ENCRYPTION[ğŸ’¾ Encrypted Backups&lt;br/&gt;Secure Storage]
        AUDIT_LOGGING[ğŸ“Š Audit Logging&lt;br/&gt;Compliance Tracking]
        DATA_MASKING[ğŸ­ Data Masking&lt;br/&gt;PII Protection]
    end

    subgraph &quot;Threat Detection&quot;
        INTRUSION_DETECTION[ğŸš¨ Intrusion Detection&lt;br/&gt;Anomaly Detection]
        LOG_ANALYSIS[ğŸ” Log Analysis&lt;br/&gt;Pattern Recognition]
        VULNERABILITY_SCANNING[ğŸ›¡ï¸ Vulnerability Scanning&lt;br/&gt;Security Updates]
        COMPLIANCE_MONITORING[ğŸ“‹ Compliance Monitoring&lt;br/&gt;Policy Enforcement]
    end

    CLOUDFLARE --&gt; INGRESS
    INGRESS --&gt; NETWORK_POLICIES
    NETWORK_POLICIES --&gt; SERVICE_MESH
    OAUTH --&gt; RBAC
    RBAC --&gt; VAULT
    VAULT --&gt; CERT_MANAGER
    ENCRYPTION --&gt; BACKUP_ENCRYPTION
    BACKUP_ENCRYPTION --&gt; AUDIT_LOGGING
    AUDIT_LOGGING --&gt; DATA_MASKING
    INTRUSION_DETECTION --&gt; LOG_ANALYSIS
    LOG_ANALYSIS --&gt; VULNERABILITY_SCANNING
    VULNERABILITY_SCANNING --&gt; COMPLIANCE_MONITORING</code></pre>
<h3 id="security-control-categories">Security Control Categories</h3>
<h4 id="prevent-block-attacks">Prevent (Block Attacks)</h4>
<ul>
<li><strong>ğŸ›¡ï¸ Web Application Firewall (WAF):</strong> Blocks common web attacks</li>
<li><strong>ğŸ”’ Network Policies:</strong> Prevents unauthorized network access</li>
<li><strong>ğŸ‘¥ Access Controls:</strong> Enforces authentication and authorization</li>
<li><strong>ğŸ” Encryption:</strong> Protects data in transit and at rest</li>
</ul>
<h4 id="detect-identify-threats">Detect (Identify Threats)</h4>
<ul>
<li><strong>ğŸ“Š Intrusion Detection:</strong> Monitors for suspicious activities</li>
<li><strong>ğŸ” Log Analysis:</strong> Identifies patterns and anomalies</li>
<li><strong>ğŸ“ˆ Anomaly Detection:</strong> Flags unusual behavior</li>
<li><strong>ğŸ›¡ï¸ Vulnerability Scanning:</strong> Finds security weaknesses</li>
</ul>
<h4 id="respond-handle-incidents">Respond (Handle Incidents)</h4>
<ul>
<li><strong>ğŸš¨ Automated Alerts:</strong> Immediate notification of security events</li>
<li><strong>ğŸ”„ Incident Response:</strong> Pre-defined response procedures</li>
<li><strong>ğŸ“‹ Forensic Analysis:</strong> Detailed investigation capabilities</li>
<li><strong>ğŸ”§ Recovery Procedures:</strong> Quick restoration of services</li>
</ul>
<h4 id="recover-restore-operations">Recover (Restore Operations)</h4>
<ul>
<li><strong>ğŸ’¾ Secure Backups:</strong> Encrypted, tested backup procedures</li>
<li><strong>ğŸ”„ Disaster Recovery:</strong> Business continuity planning</li>
<li><strong>ğŸ“Š Recovery Testing:</strong> Regular DR drills and validation</li>
<li><strong>ğŸ“ˆ Lessons Learned:</strong> Continuous improvement process</li>
</ul>
<hr />
<h2 id="authentication-authorization">ğŸ” Authentication &amp; Authorization</h2>
<h3 id="multi-factor-authentication-mfa">Multi-Factor Authentication (MFA)</h3>
<p>TCA InfraForge supports multiple authentication methods:</p>
<h4 id="oauth2-integration">OAuth2 Integration</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OAuth2 Proxy Configuration</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">oauth2_proxy</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;github&quot;</span><span class="co">  # or google, azure, okta, etc.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">client_id</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;your_client_id&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">client_secret</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;your_client_secret&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cookie_secret</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;random_string_here&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email_domains</span><span class="kw">:</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;company.com&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">github_org</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;your-organization&quot;</span></span></code></pre></div>
<h4 id="ldapactive-directory-integration">LDAP/Active Directory Integration</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LDAP Authentication Setup</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ldap</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">host</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;ldap.company.com&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">389</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bind_dn</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;cn=admin,dc=company,dc=com&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bind_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;admin_password&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user_search_base</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;ou=users,dc=company,dc=com&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user_search_filter</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;(uid=%s)&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_search_base</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;ou=groups,dc=company,dc=com&quot;</span></span></code></pre></div>
<h3 id="role-based-access-control-rbac">Role-Based Access Control (RBAC)</h3>
<h4 id="pre-defined-roles">Pre-defined Roles</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kubernetes RBAC Configuration</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRole</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> tca-admin</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;*&quot;</span><span class="kw">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;*&quot;</span><span class="kw">]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;*&quot;</span><span class="kw">]</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRole</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> tca-developer</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;apps&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;extensions&quot;</span><span class="kw">]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;deployments&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;replicasets&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;pods&quot;</span><span class="kw">]</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;watch&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;create&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;update&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;patch&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;delete&quot;</span><span class="kw">]</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRole</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> tca-viewer</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;*&quot;</span><span class="kw">]</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;*&quot;</span><span class="kw">]</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;watch&quot;</span><span class="kw">]</span></span></code></pre></div>
<h4 id="custom-role-creation">Custom Role Creation</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom role for specific team</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create role team-alpha-developer <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--verb</span><span class="op">=</span>get,list,watch,create,update,patch,delete <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--resource</span><span class="op">=</span>pods,services,deployments <span class="dt">\</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">--namespace</span><span class="op">=</span>team-alpha</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind role to user</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create rolebinding team-alpha-binding <span class="dt">\</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">--role</span><span class="op">=</span>team-alpha-developer <span class="dt">\</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">--user</span><span class="op">=</span>john.doe@company.com <span class="dt">\</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">--namespace</span><span class="op">=</span>team-alpha</span></code></pre></div>
<hr />
<h2 id="secrets-management-with-hashicorp-vault">ğŸ”’ Secrets Management with HashiCorp Vault</h2>
<h3 id="vault-architecture">Vault Architecture</h3>
<pre class="mermaid"><code>graph TB
    subgraph &quot;Applications&quot;
        API[ğŸ”Œ API Server]
        WEB[ğŸŒ Web Frontend]
        WORKER[âš™ï¸ Background Worker]
    end

    subgraph &quot;Vault Server&quot;
        VAULT[ğŸ”’ HashiCorp Vault&lt;br/&gt;Secrets Engine]
        AUTH[ğŸ” Authentication&lt;br/&gt;Methods]
        POLICIES[ğŸ“‹ Access Policies&lt;br/&gt;RBAC]
        AUDIT[ğŸ“Š Audit Device&lt;br/&gt;Logging]
    end

    subgraph &quot;Secret Storage&quot;
        KV[ğŸ”‘ Key-Value Store&lt;br/&gt;Static Secrets]
        DB[ğŸ’¾ Database Credentials&lt;br/&gt;Dynamic Secrets]
        PKI[ğŸ“œ PKI Certificates&lt;br/&gt;SSL/TLS Certs]
        TRANSIT[ğŸ”„ Transit Engine&lt;br/&gt;Encryption as Service]
    end

    API --&gt; VAULT
    WEB --&gt; VAULT
    WORKER --&gt; VAULT
    VAULT --&gt; KV
    VAULT --&gt; DB
    VAULT --&gt; PKI
    VAULT --&gt; TRANSIT</code></pre>
<h3 id="setting-up-vault-secrets">Setting Up Vault Secrets</h3>
<h4 id="initialize-vault">1. Initialize Vault</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access Vault UI</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/vault 8200:8200</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">open</span> https://localhost:8200</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize with key shares</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> operator init <span class="at">-key-shares</span><span class="op">=</span>5 <span class="at">-key-threshold</span><span class="op">=</span>3</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Unseal Vault (run 3 times with different keys)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> operator unseal</span></code></pre></div>
<h4 id="configure-authentication">2. Configure Authentication</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable Kubernetes authentication</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> auth enable kubernetes</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure Kubernetes auth method</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> write auth/kubernetes/config <span class="dt">\</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  token_reviewer_jwt=<span class="st">&quot;</span><span class="va">$(</span><span class="fu">cat</span> /var/run/secrets/kubernetes.io/serviceaccount/token<span class="va">)</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  kubernetes_host=<span class="st">&quot;https://</span><span class="va">$KUBERNETES_PORT_443_TCP_ADDR</span><span class="st">:443&quot;</span> <span class="dt">\</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create policy for database access</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> policy write db-access <span class="at">-</span> <span class="op">&lt;&lt;EOF</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">path &quot;database/creds/my-role&quot; {</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">  capabilities = [&quot;read&quot;]</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span></code></pre></div>
<h4 id="store-application-secrets">3. Store Application Secrets</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store static secrets</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> kv put secret/myapp/database <span class="dt">\</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  username=<span class="st">&quot;myapp_user&quot;</span> <span class="dt">\</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  password=<span class="st">&quot;super_secret_password&quot;</span> <span class="dt">\</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  host=<span class="st">&quot;postgres-service&quot;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable database secrets engine</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> secrets enable database</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure database connection</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> write database/config/postgresql <span class="dt">\</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  plugin_name=postgresql-database-plugin <span class="dt">\</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  allowed_roles=<span class="st">&quot;my-role&quot;</span> <span class="dt">\</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  connection_url=<span class="st">&quot;postgresql://{{username}}:{{password}}@postgres:5432/myapp&quot;</span> <span class="dt">\</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  username=<span class="st">&quot;vault_admin&quot;</span> <span class="dt">\</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  password=<span class="st">&quot;vault_admin_password&quot;</span></span></code></pre></div>
<h4 id="application-integration">4. Application Integration</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python example: Reading secrets from Vault</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvac</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Vault client</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> hvac.Client(url<span class="op">=</span><span class="st">&#39;https://vault.tca-infraforge.com:8200&#39;</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Authenticate with Kubernetes service account</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;/var/run/secrets/kubernetes.io/serviceaccount/token&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    jwt <span class="op">=</span> f.read()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>client.auth_kubernetes(<span class="st">&quot;myapp&quot;</span>, jwt)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read database credentials</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>secrets <span class="op">=</span> client.secrets.kv.v2.read_secret_version(<span class="st">&#39;secret/myapp/database&#39;</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>db_config <span class="op">=</span> {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;username&#39;</span>: secrets[<span class="st">&#39;data&#39;</span>][<span class="st">&#39;data&#39;</span>][<span class="st">&#39;username&#39;</span>],</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;password&#39;</span>: secrets[<span class="st">&#39;data&#39;</span>][<span class="st">&#39;data&#39;</span>][<span class="st">&#39;password&#39;</span>],</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;host&#39;</span>: secrets[<span class="st">&#39;data&#39;</span>][<span class="st">&#39;data&#39;</span>][<span class="st">&#39;host&#39;</span>]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="network-security">ğŸ›¡ï¸ Network Security</h2>
<h3 id="kubernetes-network-policies">Kubernetes Network Policies</h3>
<h4 id="default-security-policy">Default Security Policy</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Block all traffic by default</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> networking.k8s.io/v1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> NetworkPolicy</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> default-deny-all</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">podSelector</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">policyTypes</span><span class="kw">:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Ingress</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Egress</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Allow internal traffic</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> networking.k8s.io/v1</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> NetworkPolicy</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> allow-internal</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">podSelector</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">policyTypes</span><span class="kw">:</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Ingress</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Egress</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ingress</span><span class="kw">:</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">namespaceSelector</span><span class="kw">:</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">egress</span><span class="kw">:</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">to</span><span class="kw">:</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">namespaceSelector</span><span class="kw">:</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> production</span></span></code></pre></div>
<h4 id="application-specific-policies">Application-Specific Policies</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API Server network policy</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> networking.k8s.io/v1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> NetworkPolicy</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api-server-policy</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">podSelector</span><span class="kw">:</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> api-server</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">policyTypes</span><span class="kw">:</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Ingress</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ingress</span><span class="kw">:</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">namespaceSelector</span><span class="kw">:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ingress</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">podSelector</span><span class="kw">:</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">app</span><span class="kw">:</span><span class="at"> web-frontend</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">protocol</span><span class="kw">:</span><span class="at"> TCP</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Database isolation policy</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> networking.k8s.io/v1</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> NetworkPolicy</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> database-isolation</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">podSelector</span><span class="kw">:</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">policyTypes</span><span class="kw">:</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> Ingress</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ingress</span><span class="kw">:</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">podSelector</span><span class="kw">:</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">app</span><span class="kw">:</span><span class="at"> api-server</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">protocol</span><span class="kw">:</span><span class="at"> TCP</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span></code></pre></div>
<h3 id="service-mesh-security-istio">Service Mesh Security (Istio)</h3>
<h4 id="mutual-tls-mtls-configuration">Mutual TLS (mTLS) Configuration</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable mTLS for all services</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> security.istio.io/v1beta1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> PeerAuthentication</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> istio-system</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mtls</span><span class="kw">:</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mode</span><span class="kw">:</span><span class="at"> STRICT</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Destination rule for traffic policies</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> networking.istio.io/v1beta1</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> DestinationRule</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api-server-mtls</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">host</span><span class="kw">:</span><span class="at"> api-server.production.svc.cluster.local</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">trafficPolicy</span><span class="kw">:</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tls</span><span class="kw">:</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mode</span><span class="kw">:</span><span class="at"> ISTIO_MUTUAL</span></span></code></pre></div>
<hr />
<h2 id="compliance-audit-logging">ğŸ“œ Compliance &amp; Audit Logging</h2>
<h3 id="compliance-frameworks-supported">Compliance Frameworks Supported</h3>
<h4 id="soc-2-type-ii-compliance">SOC 2 Type II Compliance</h4>
<ul>
<li><strong>Trust Services Criteria:</strong> Security, Availability, Processing Integrity</li>
<li><strong>Audit Trail:</strong> Complete activity logging with tamper-proof storage</li>
<li><strong>Access Controls:</strong> Role-based access with audit logging</li>
<li><strong>Change Management:</strong> Version-controlled configuration changes</li>
</ul>
<h4 id="gdpr-compliance">GDPR Compliance</h4>
<ul>
<li><strong>Data Protection:</strong> Encryption of personal data at rest and in transit</li>
<li><strong>Access Controls:</strong> Principle of least privilege</li>
<li><strong>Audit Logging:</strong> Complete data access and processing logs</li>
<li><strong>Data Portability:</strong> Export capabilities for user data</li>
</ul>
<h4 id="hipaa-compliance">HIPAA Compliance</h4>
<ul>
<li><strong>Data Encryption:</strong> Protected health information (PHI) encryption</li>
<li><strong>Access Logging:</strong> All PHI access events logged</li>
<li><strong>Network Security:</strong> Secure transmission of health data</li>
<li><strong>Disaster Recovery:</strong> Business continuity for health data</li>
</ul>
<h3 id="audit-logging-implementation">Audit Logging Implementation</h3>
<h4 id="centralized-audit-collection">Centralized Audit Collection</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fluent Bit audit log configuration</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> fluent-bit-audit-config</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">  fluent-bit.conf</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    [INPUT]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        Name              tail</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        Path              /var/log/kubernetes/audit.log</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        Parser            json</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        Tag               audit.*</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    [OUTPUT]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        Name              elasticsearch</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        Host              elasticsearch.logging.svc.cluster.local</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        Port              9200</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        Index             audit-logs</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        Type              audit</span></code></pre></div>
<h4 id="audit-log-analysis">Audit Log Analysis</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for specific user activities</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">-f</span> deployment/audit-analyzer <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;user:john.doe&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze access patterns</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> audit-analyzer <span class="at">--</span> <span class="dt">\</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  python analyze_access_patterns.py <span class="at">--user</span><span class="op">=</span>john.doe <span class="at">--timeframe</span><span class="op">=</span>24h</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate compliance reports</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> audit-analyzer <span class="at">--</span> <span class="dt">\</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  python generate_compliance_report.py <span class="at">--framework</span><span class="op">=</span>gdpr <span class="at">--period</span><span class="op">=</span>monthly</span></code></pre></div>
<hr />
<h2 id="vulnerability-management">ğŸ›¡ï¸ Vulnerability Management</h2>
<h3 id="automated-security-scanning">Automated Security Scanning</h3>
<h4 id="container-image-scanning">Container Image Scanning</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scan images before deployment</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">trivy</span> image <span class="at">--exit-code</span> 1 <span class="at">--no-progress</span> myapp:latest</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scan running containers</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">trivy</span> k8s <span class="at">--report</span> summary cluster</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate security reports</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">trivy</span> image <span class="at">--format</span> json <span class="at">--output</span> results.json myapp:latest</span></code></pre></div>
<h4 id="kubernetes-cluster-scanning">Kubernetes Cluster Scanning</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kube-bench security assessment</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kube-bench</span> run <span class="at">--targets</span><span class="op">=</span>master,node,etcd,policies</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CIS Kubernetes benchmark</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kube-bench</span> run <span class="at">--benchmark</span> cis-1.6</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate compliance report</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kube-bench</span> run <span class="at">--json</span> <span class="at">--output</span> compliance-report.json</span></code></pre></div>
<h3 id="security-updates-patching">Security Updates &amp; Patching</h3>
<h4 id="automated-updates">Automated Updates</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kyverno policy for security updates</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> kyverno.io/v1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterPolicy</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> require-security-updates</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">validationFailureAction</span><span class="kw">:</span><span class="at"> enforce</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> check-image-security</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">match</span><span class="kw">:</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">kinds</span><span class="kw">:</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> Pod</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">validate</span><span class="kw">:</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Image must be from trusted registry and have security scan&quot;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">pattern</span><span class="kw">:</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">image</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;trusted-registry.com/*&quot;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">securityContext</span><span class="kw">:</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">runAsNonRoot</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">runAsUser</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span></span></code></pre></div>
<hr />
<h2 id="incident-response">ğŸš¨ Incident Response</h2>
<h3 id="security-incident-response-plan">Security Incident Response Plan</h3>
<h4 id="phase-1-detection-assessment-0-15-minutes">Phase 1: Detection &amp; Assessment (0-15 minutes)</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Confirm the incident</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">--sort-by</span><span class="op">=</span>.metadata.creationTimestamp <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-20</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Isolate affected systems</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> cordon affected-node</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Gather initial evidence</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">--previous</span> affected-pod <span class="op">&gt;</span> incident-evidence.log</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Notify security team</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST <span class="at">-H</span> <span class="st">&#39;Content-type: application/json&#39;</span> <span class="dt">\</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">--data</span> <span class="st">&#39;{&quot;text&quot;:&quot;Security incident detected&quot;}&#39;</span> <span class="dt">\</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  SLACK_WEBHOOK_URL</span></code></pre></div>
<h4 id="phase-2-containment-15-60-minutes">Phase 2: Containment (15-60 minutes)</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Block malicious traffic</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> emergency-network-policy.yaml</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Revoke compromised credentials</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> token revoke compromised_token</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Update security policies</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> updated-security-policies.yaml</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Take system snapshots</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get all <span class="at">-o</span> yaml <span class="op">&gt;</span> incident-snapshot.yaml</span></code></pre></div>
<h4 id="phase-3-eradication-1-4-hours">Phase 3: Eradication (1-4 hours)</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Remove malicious code</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> delete pod malicious-pod</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Patch vulnerabilities</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/myapp myapp=secure-image:v2</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Update secrets</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> kv put secret/myapp/api-key value=new_secure_key</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Clean up backdoors</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> security-hardening.yaml</span></code></pre></div>
<h4 id="phase-4-recovery-lessons-learned-4-hours">Phase 4: Recovery &amp; Lessons Learned (4+ hours)</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Restore from clean backups</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/restore-from-backup.sh</span> clean-backup-20241201</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Validate system integrity</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/security-validation.sh</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Monitor for recurrence</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> enhanced-monitoring.yaml</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Document lessons learned</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create incident report and update procedures</span></span></code></pre></div>
<h3 id="automated-incident-response">Automated Incident Response</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kyverno policy for automated response</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> kyverno.io/v1</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterPolicy</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> automated-incident-response</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> quarantine-suspicious-pod</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">match</span><span class="kw">:</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">kinds</span><span class="kw">:</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> Pod</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">preconditions</span><span class="kw">:</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">all</span><span class="kw">:</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ request.object.spec.containers[].securityContext.privileged }}&quot;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">operator</span><span class="kw">:</span><span class="at"> Equals</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mutate</span><span class="kw">:</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">patchStrategicMerge</span><span class="kw">:</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">security</span><span class="kw">:</span><span class="at"> quarantined</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">nodeSelector</span><span class="kw">:</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">security</span><span class="kw">:</span><span class="at"> quarantine</span></span></code></pre></div>
<hr />
<h2 id="security-monitoring-reporting">ğŸ“Š Security Monitoring &amp; Reporting</h2>
<h3 id="security-dashboards">Security Dashboards</h3>
<h4 id="real-time-security-monitoring">Real-Time Security Monitoring</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access security dashboard</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">open</span> https://grafana.tca-infraforge.com/d/security-overview</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Key security metrics to monitor:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Failed authentication attempts</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - Unusual network traffic patterns</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - Privilege escalation events</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Configuration changes</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - Compliance violations</span></span></code></pre></div>
<h4 id="automated-security-reports">Automated Security Reports</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate daily security report</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/generate-security-report.sh</span> <span class="at">--period</span><span class="op">=</span>daily</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate compliance report</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/generate-compliance-report.sh</span> <span class="at">--framework</span><span class="op">=</span>soc2</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Send reports to stakeholders</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/send-security-reports.sh</span> <span class="at">--recipients</span><span class="op">=</span>security-team@company.com</span></code></pre></div>
<h3 id="security-metrics-kpis">Security Metrics &amp; KPIs</h3>
<h4 id="key-security-indicators">Key Security Indicators</h4>
<ul>
<li><strong>Authentication Success Rate:</strong> &gt; 99.9%</li>
<li><strong>Average Response Time to Threats:</strong> &lt; 15 minutes</li>
<li><strong>False Positive Rate:</strong> &lt; 5%</li>
<li><strong>Compliance Score:</strong> &gt; 95%</li>
<li><strong>Security Incident Response Time:</strong> &lt; 1 hour</li>
<li><strong>Patch Management Coverage:</strong> &gt; 98%</li>
</ul>
<hr />
<h2 id="security-troubleshooting">ğŸ†˜ Security Troubleshooting</h2>
<h3 id="common-security-issues">Common Security Issues</h3>
<h4 id="issue-authentication-failures">Issue: Authentication Failures</h4>
<pre><code>âŒ Error: Login attempts failing
âœ… Solution: Check OAuth2 configuration
   kubectl logs deployment/oauth2-proxy
   Verify provider settings
   Check network connectivity to provider</code></pre>
<h4 id="issue-certificate-expiration">Issue: Certificate Expiration</h4>
<pre><code>âŒ Error: SSL certificate expired
âœ… Solution: Renew certificates automatically
   kubectl get certificates
   cert-manager will auto-renew
   Check cert-manager status</code></pre>
<h4 id="issue-network-policy-blocking-traffic">Issue: Network Policy Blocking Traffic</h4>
<pre><code>âŒ Error: Services cannot communicate
âœ… Solution: Review network policies
   kubectl get networkpolicies
   Check policy rules
   Use kubectl describe for details</code></pre>
<h4 id="issue-vault-seal-status">Issue: Vault Seal Status</h4>
<pre><code>âŒ Error: Vault is sealed
âœ… Solution: Unseal Vault
   vault operator unseal
   Provide unseal keys
   Check seal status</code></pre>
<h3 id="security-hardening-commands">Security Hardening Commands</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run security assessment</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/security-assessment.sh</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Update all security policies</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/update-security-policies.sh</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate all secrets</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/rotate-secrets.sh</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate security configuration</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">./scripts/validate-security.sh</span></span></code></pre></div>
<hr />
<h2 id="summary">ğŸ“‹ Summary</h2>
<p>TCA InfraForgeâ€™s security implementation provides <strong>enterprise-grade protection</strong> with:</p>
<ul>
<li><strong>ğŸ›¡ï¸ Defense in Depth:</strong> Multiple security layers working together</li>
<li><strong>ğŸ” Zero-Trust Architecture:</strong> Never trust, always verify</li>
<li><strong>ğŸ“œ Complete Audit Trail:</strong> Full compliance and forensic capabilities</li>
<li><strong>ğŸš¨ Automated Response:</strong> Intelligent incident detection and response</li>
<li><strong>ğŸ“Š Continuous Monitoring:</strong> Real-time security visibility</li>
</ul>
<h3 id="key-takeaways">Key Takeaways</h3>
<ol type="1">
<li><strong>Security First:</strong> Built into every layer of the architecture</li>
<li><strong>Compliance Ready:</strong> Supports major compliance frameworks</li>
<li><strong>Automated Protection:</strong> Intelligent threat detection and response</li>
<li><strong>Complete Visibility:</strong> Full audit trail and monitoring</li>
<li><strong>Recovery Focused:</strong> Comprehensive backup and disaster recovery</li>
</ol>
<hr />
<h2 id="implemented-security-hardening">ğŸ”§ Implemented Security Hardening</h2>
<p>TCA InfraForge automatically applies <strong>production-ready security</strong> to all deployments:</p>
<h3 id="container-security">Container Security</h3>
<ul>
<li><strong>Non-root execution:</strong> All containers run as non-root users</li>
<li><strong>Read-only filesystems:</strong> Prevents unauthorized file modifications</li>
<li><strong>Dropped capabilities:</strong> Removes unnecessary Linux capabilities</li>
<li><strong>Security contexts:</strong> Enforced for all pods and containers</li>
</ul>
<h3 id="resource-protection">Resource Protection</h3>
<ul>
<li><strong>CPU and memory limits:</strong> Prevents resource exhaustion attacks</li>
<li><strong>Requests and limits:</strong> Ensures fair resource allocation</li>
<li><strong>Pod disruption budgets:</strong> Maintains availability during updates</li>
</ul>
<h3 id="network-security-1">Network Security</h3>
<ul>
<li><strong>Network policies:</strong> Isolates traffic between services</li>
<li><strong>TLS encryption:</strong> Secures all communications</li>
<li><strong>Ingress security:</strong> Protects external access points</li>
</ul>
<h3 id="automated-security">Automated Security</h3>
<p>All security measures are applied automatically through <strong>Kustomize patches</strong> - no manual configuration needed!</p>
<hr />
<h2 id="whats-next">ğŸ¯ Whatâ€™s Next?</h2>
<p>Now that you understand security, youâ€™re ready to:</p>
<ol type="1">
<li><strong><a href="./10-cloudflare-integration.md">â˜ï¸ Cloudflare Integration</a></strong> - Set up external access and protection</li>
<li><strong><a href="./11-performance-optimization.md">ğŸ› ï¸ Advanced Configuration</a></strong> - Fine-tune performance and security</li>
<li><strong><a href="./12-ci-cd-pipeline.md">âš™ï¸ CI/CD Pipeline</a></strong> - Implement automated deployment pipelines</li>
</ol>
<p><strong>ğŸ’¡ Pro Tip:</strong> Security is not a one-time setup - itâ€™s an ongoing process. Regularly review your security posture, update policies, and conduct security assessments!</p>
<hr />
<p><em>Ready to connect your platform to the world? Letâ€™s move to the Cloudflare Integration chapter to set up secure external access!</em> â˜ï¸</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });

        // Add copy buttons to code blocks
        document.querySelectorAll('pre').forEach(pre => {
            const button = document.createElement('button');
            button.className = 'btn btn-sm btn-outline-primary copy-btn';
            button.innerHTML = '<i class="fas fa-copy"></i>';
            button.style.position = 'absolute';
            button.style.top = '10px';
            button.style.right = '10px';
            pre.style.position = 'relative';
            pre.appendChild(button);
            button.addEventListener('click', () => {
                const code = pre.querySelector('code') ? pre.querySelector('code').textContent : pre.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    button.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => button.innerHTML = '<i class="fas fa-copy"></i>', 2000);
                });
            });
        });

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = darkModeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i> Light';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i> Dark';
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            darkModeToggle.innerHTML = '<i class="fas fa-sun"></i> Light';
        }

        // Reading progress
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.offsetHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            document.getElementById('progressBar').style.width = scrollPercent + '%';
        });

        // Back to top
        const backToTopBtn = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.style.display = 'block';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            let found = false;
            headings.forEach(h => {
                if (!found && h.textContent.toLowerCase().includes(query)) {
                    h.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    found = true;
                }
            });
        });

        // Get current page number from filename
        const currentPath = window.location.pathname;
        const fileName = currentPath.split('/').pop();

        const pageFiles = [
            '01-executive-summary.html',
            '02-architecture-overview.html',
            '03-quick-start-guide.html',
            '04-automated-deployment.html',
            '05-container-kubernetes.html',
            '06-networking-ingress.html',
            '07-monitoring-observability.html',
            '08-enterprise-applications.html',
            '09-security-compliance.html',
            '10-cloudflare-integration.html',
            '10-troubleshooting-guide.html',
            '11-performance-optimization.html',
            '11-troubleshooting-guide.html',
            '12-ci-cd-pipeline.html',
            '13-contributing-development.html',
            'ABOUT.html',
            'ADVANCED-TOOLS-INTEGRATION-REPORT.html',
            'APPLE-SILICON-INTEGRATION.html',
            'BOOK.html',
            'CLOUDFLARE-DNS-CLI-SETUP.html',
            'CONSOLIDATION-COMPLETE.html',
            'ENHANCEMENT-DOCUMENTATION.html',
            'GHCR-SETUP-GUIDE.html',
            'INDEX.html',
            'KUBERNETES-TROUBLESHOOTING.html',
            'MAC-MINI-QUICKSTART.html',
            'README.html',
            'SCRIPT-SECURITY-AUDIT.html',
            'SECURITY-SETUP-GUIDE.html'
        ];

        const pageTitles = pageFiles.map(file => file.replace('.html', '').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));

        let currentPage = pageFiles.indexOf(fileName) + 1;
        if (currentPage === 0) currentPage = 1; // for index.html or others

        const totalPages = pageFiles.length;

        // Generate pagination
        const pagination = document.getElementById('pagination');
        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            li.className = 'page-item' + (i === currentPage ? ' active' : '');
            const a = document.createElement('a');
            a.className = 'page-link';
            a.href = pageFiles[i - 1];
            a.textContent = i;
            li.appendChild(a);
            pagination.appendChild(li);
        }

        // Update dropdown
        const dropdown = document.querySelector('.dropdown-menu');
        dropdown.innerHTML = '';
        pageFiles.forEach((file, index) => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.className = 'dropdown-item';
            a.href = file;
            a.textContent = `${index + 1}. ${pageTitles[index]}`;
            li.appendChild(a);
            dropdown.appendChild(li);
        });

        // Prev/Next buttons
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        if (currentPage > 1) {
            prevBtn.onclick = () => window.location.href = pageFiles[currentPage - 2];
        } else {
            prevBtn.disabled = true;
        }

        if (currentPage < totalPages) {
            nextBtn.onclick = () => window.location.href = pageFiles[currentPage];
        } else {
            nextBtn.disabled = true;
        }
    </script>
</body>

</html>
<button id="backToTop" class="btn btn-primary" style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1001;"><i class="fas fa-arrow-up"></i></button>